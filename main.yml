---
- name: "onesetup - Remote Target Playbook"
  hosts:
    - workstation
  gather_facts: true
  # -- Variables -- #
  vars:
    # ansible variables
    ansible_facts_parallel: true # allow parallel facts gathering
    # environment variables
    HOME: "/Users/{{ ansible_user }}"
    XDG_CONFIG_HOME: "{{ HOME }}/.config"
    XDG_DATA_HOME: "{{ HOME }}/.local/share"
    XDG_STATE_HOME: "{{ HOME }}/.local/state"
    XDG_CACHE_HOME: "{{ HOME }}/.cache"
    ZDOTDIR: "{{ HOME }}"
    # onesetup variables (passed by control-node entrypoint script)
    ONESETUP_DIR: '{{ lookup("env", "ONESETUP_DIR") }}'
    DOTFILES_DIR: '{{ lookup("env", "DOTFILES_DIR") }}'
    ONESETUP_REPO: '{{ lookup("env", "ONESETUP_REPO") }}'
    DOTFILES_REPO: '{{ lookup("env", "DOTFILES_REPO") }}'
    ONESETUP_REPO_SSH: "git@github.com:{{ ONESETUP_REPO }}.git"
    ONESETUP_REPO_HTTPS: "https://github.com/{{ ONESETUP_REPO }}.git"
    ONESETUP_REPO_RAW: "https://raw.githubusercontent.com/{{ ONESETUP_REPO }}/main"
    DOTFILES_REPO_SSH: "git@github.com:{{ DOTFILES_REPO }}.git"
    DOTFILES_REPO_HTTPS: "https://github.com/{{ DOTFILES_REPO }}.git"
    DOTFILES_REPO_RAW: "https://raw.githubusercontent.com/{{ DOTFILES_REPO }}/main"

  # -- Pre Tasks -- #
  pre_tasks:
    - import_tasks: pre_tasks/user.yml
    - import_tasks: pre_tasks/filesystem.yml
  tasks:
    - import_tasks: tasks/settings.yml
  # -- Roles -- #
  roles:
    - role: elliotweiser.osx-command-line-tools
      when: ansible_facts['os_family'] == 'Darwin'
    - role: 'dotfiles'
