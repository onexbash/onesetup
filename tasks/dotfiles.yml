---
# Clone Dotfiles Repository
- name: 'Clone Dotfiles Repository'
  git:
    repo: '{{ dotfiles_repo_uri }}'
    dest: '{{ dotfiles_dir }}'
    update: true

# File Permissions: Dotfiles
- name: 'Set File Permissions: {{ dotfiles_dir }}/*'
  file:
    path: '{{ dotfiles_dir }}'
    state: directory
    mode: '0774'
    owner: '{{ ansible_user }}'
    group: 'wheel'
    recurse: true

# Cleanup: global shell config
- name: 'Cleanup: global shell config files (bash & zsh)'
  file:
    path: '{{ item.dest }}'
    state: absent
  loop:
    - { src: "{{ dotfiles_dir }}/shell/global/profile", dest: "/etc/profile" }
    - { src: "{{ dotfiles_dir }}/shell/global/zshenv", dest: "/etc/zshenv" }
    - { src: "{{ dotfiles_dir }}/shell/global/zprofile", dest: "/etc/zprofile" }
    - { src: "{{ dotfiles_dir }}/shell/global/zshrc", dest: "/etc/zshrc" }
    - { src: "{{ dotfiles_dir }}/shell/global/zlogout", dest: "/etc/zlogout" }
  ignore_errors: true

# Rollout: global shell config
- name: "Rollout: global shell config files (bash & zsh)"
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: "{{ ansible_user }}"
    group: "wheel"
    mode: "0644"
  loop:
    - { src: "{{ dotfiles_dir }}/shell/global/profile", dest: "/etc/profile" }
    - { src: "{{ dotfiles_dir }}/shell/global/zshenv", dest: "/etc/zshenv" }
    - { src: "{{ dotfiles_dir }}/shell/global/zprofile", dest: "/etc/zprofile" }
    - { src: "{{ dotfiles_dir }}/shell/global/zshrc", dest: "/etc/zshrc" }
    - { src: "{{ dotfiles_dir }}/shell/global/zlogout", dest: "/etc/zlogout" }

# Cleanup: Dotfiles Targets
- name: 'Clean up Dotfiles Targets'
  file:
    path: '{{ item.dest }}'
    state: absent
  loop:
    - { src: "{{ dotfiles_dir }}/shell/home", dest: "{{ XDG_CONFIG_HOME }}/zsh" }
    - { src: "{{ dotfiles_dir }}/nvim", dest: "{{ XDG_CONFIG_HOME }}/nvim" }
    - { src: "{{ dotfiles_dir }}/alacritty", dest: "{{ XDG_CONFIG_HOME }}/alacritty" }
    - { src: "{{ dotfiles_dir }}/git", dest: "{{ XDG_CONFIG_HOME }}/git" }
    - { src: "{{ dotfiles_dir }}/starship", dest: "{{ XDG_CONFIG_HOME }}/starship" }
    - { src: "{{ dotfiles_dir }}/aerospace", dest: "{{ XDG_CONFIG_HOME }}/aerospace" }
    - { src: "{{ dotfiles_dir }}/atuin", dest: "{{ XDG_CONFIG_HOME }}/atuin" }
    - { src: "{{ dotfiles_dir }}/eza", dest: "{{ XDG_CONFIG_HOME }}/eza" }
    - { src: "{{ dotfiles_dir }}/lazygit", dest: "{{ XDG_CONFIG_HOME }}/lazygit" }
    - { src: "{{ dotfiles_dir }}/zed", dest: "{{ XDG_CONFIG_HOME }}/zed" }
  ignore_errors: true

# Rollout: Dotfiles
- name: 'Symlink Dotfiles'
  file:
    src: '{{ item.origin }}'
    dest: '{{ item.target }}'
    state: link
    owner: "{{ ansible_user }}"
    group: "wheel"
    force: true
  loop:
    - { src: "{{ dotfiles_dir }}/shell/home", dest: "{{ XDG_CONFIG_HOME }}/zsh" }
    - { src: "{{ dotfiles_dir }}/nvim", dest: "{{ XDG_CONFIG_HOME }}/nvim" }
    - { src: "{{ dotfiles_dir }}/alacritty", dest: "{{ XDG_CONFIG_HOME }}/alacritty" }
    - { src: "{{ dotfiles_dir }}/git", dest: "{{ XDG_CONFIG_HOME }}/git" }
    - { src: "{{ dotfiles_dir }}/starship", dest: "{{ XDG_CONFIG_HOME }}/starship" }
    - { src: "{{ dotfiles_dir }}/aerospace", dest: "{{ XDG_CONFIG_HOME }}/aerospace" }
    - { src: "{{ dotfiles_dir }}/atuin", dest: "{{ XDG_CONFIG_HOME }}/atuin" }
    - { src: "{{ dotfiles_dir }}/eza", dest: "{{ XDG_CONFIG_HOME }}/eza" }
    - { src: "{{ dotfiles_dir }}/lazygit", dest: "{{ XDG_CONFIG_HOME }}/lazygit" }
    - { src: "{{ dotfiles_dir }}/zed", dest: "{{ XDG_CONFIG_HOME }}/zed" }
